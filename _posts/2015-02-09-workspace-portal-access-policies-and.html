---
layout: post
title: Workspace Portal, Access Policies, and Kerberos authentication
date: '2015-02-09T18:11:00.000-08:00'
author: thatvirtualboy
excerpt: "You’ve decided it’s time to expand your Workspace Portal deployment from internal-only, to also allow external access. You’ve setup your Load Balancer, gotten your certificates in place, and now you’re tasked with configuring internal and external authentication methods. What's next?"
tags:
- sso
- workspace
- kerberos
modified_time: '2017-08-03T10:14:47.118-07:00'
blogger_id: tag:blogger.com,1999:blog-733606464149134140.post-6768761297393333275
blogger_orig_url: https://www.thatvirtualboy.com/2015/02/workspace-portal-access-policies-and.html
---

You've decided it's time to expand your Workspace Portal deployment from internal-only, to also allow external access. You've setup your Load Balancer, gotten your certificates in place, and now you're tasked with configuring internal and external authentication methods.<br/><br/>This post covers the configuration needed for Kerberos on internal connections, while allowing username/password authentication from external connections.<br/><h4>Access Policies</h4><br/>First, let's setup your access policies. Access Policies allow you to specify criteria that users must meet in order to access Workspace Portal. We're going to configure the Default Access Policy Set to include two policies: internal and external<br/><br/>For our <b>internal connections</b>, we're going to utilize Kerberos. Configuring Kerberos isn't covered in this post, so ensure you have it working first. Here are some helpful posts for setting it up:<br/><br/><a href="http://pubs.vmware.com/workspace-portal-21/topic/com.vmware.wsp-install_21/GUID-10D04CEF-0C03-43E9-B73D-CFA94F803EEB.html" target="_blank">Configuring Kerberos for Workspace</a><br/><a href="http://blogs.vmware.com/horizontech/2014/03/configure-kerberos-sso-horizon-workspace-1-8.html" target="_blank">Kerberos SSO in Workspace 1.8</a> (basic config flow still applies to Workspace Portal 2.1)<br/><br/>For our <b>external connections</b>, we'll let our users utilize their Active Directory synced username and passwords for authentication. Ensure your Directory Sync rules from the Connector Service Admin page include all desired AD groups and that they're synced regularly.<br/><br/>First: ensure you've created both an <b>internal </b>and an <b>external </b><a href="http://pubs.vmware.com/workspace-portal-21/topic/com.vmware.wsp-administrator_21/GUID-3D7AB065-E2ED-4525-B575-2A576BAA3CC3.html" target="_blank">Network Range</a>:<br/><ol><br/>	<li>Log into the Workspace Admin Portal &gt; Settings &gt; Network Ranges</li><br/>	<li>Click <b>+ Network Range</b> to add our internal range. Configure this to the appropriate subnets used in your LAN.</li><br/>	<li>We'll use the default ALL RANGES entry for our external connections</li><br/></ol><br/>Then, from the <b>Policies </b>tab, we'll edit the default_access_policy_set to correspond to these network ranges.<br/><ol><br/>	<li>Click <b>+ Access Policy</b> and name it internal. Set it to use a <b>Minimum Authentication Score of 1. </b></li><br/>	<li>Then select the default 'web policy' which corresponds to our external network range. We'll set this to a <b>Minimum Authentication Score of 2</b> as seen below:</li><br/></ol><br/>NOTE: Be sure to re-arrange the policies so that internal is on top, and 'web policy' is on bottom and click <b>Save</b>.<br/><div class="separator" style="clear:both;text-align:center;"><a style="margin-left:1em;margin-right:1em;" href="https://thatvirtualboy.files.wordpress.com/2015/02/97f97-kerb1.png"><img src="https://thatvirtualboy.files.wordpress.com/2015/02/97f97-kerb1.png" alt="" width="400" height="151" border="0" /></a></div><br/><div class="separator" style="clear:both;text-align:center;"></div><br/><h4 style="clear:both;text-align:left;">Authentication method</h4><br/><div class="separator" style="clear:both;text-align:left;"></div><br/><div class="separator" style="clear:both;text-align:left;">Now, head to <b>Settings </b>&gt; <b>Authentiation Methods</b> and order the options as seen here. Be sure to click each entry to edit the Authentication Score to match the below screenshot. Once again, order is important.</div><br/><div class="separator" style="clear:both;text-align:center;"><a style="margin-left:1em;margin-right:1em;" href="https://thatvirtualboy.files.wordpress.com/2015/02/947a3-kerb2.png"><img src="https://thatvirtualboy.files.wordpress.com/2015/02/947a3-kerb2.png" alt="" width="400" height="120" border="0" /></a></div><br/><div class="separator" style="clear:both;text-align:center;"></div><br/><div class="separator" style="clear:both;text-align:left;">Notice that Kerberos is on top, with an authentication score of 1.</div><br/><div class="separator" style="clear:both;text-align:center;"><a style="margin-left:1em;margin-right:1em;" href="https://thatvirtualboy.files.wordpress.com/2015/02/49aae-kerb3.png"><img src="https://thatvirtualboy.files.wordpress.com/2015/02/49aae-kerb3.png" alt="" width="400" height="158" border="0" /></a></div><br/><div class="separator" style="clear:both;text-align:center;"></div><br/><div class="separator" style="clear:both;text-align:left;">Set Kerberos as the Default Method</div><br/><div class="separator" style="clear:both;text-align:center;"><a style="margin-left:1em;margin-right:1em;" href="https://thatvirtualboy.files.wordpress.com/2015/02/217e2-kerb4.png"><img src="https://thatvirtualboy.files.wordpress.com/2015/02/217e2-kerb4.png" alt="" width="400" height="156" border="0" /></a></div><br/><div class="separator" style="clear:both;text-align:center;"></div><br/><div class="separator" style="clear:both;text-align:left;">Password will be set to an authentication score of 2.</div><br/><div class="separator" style="clear:both;text-align:left;"></div><br/><div class="separator" style="clear:both;text-align:left;">At this point, you should be able to verify that your user portal loads from both internal and external locations, as well as verify that your internal users aren't prompted for their credentials.</div><br/><div class="separator" style="clear:both;text-align:left;"></div><br/><h4 style="clear:both;text-align:left;">Troubleshooting</h4><br/><div></div><br/><div><u>Scenario 1</u>:</div><br/><div class="separator" style="clear:both;text-align:left;">When launching Workspace Portal externally, the page times out and doesn't load, but internally it launches.</div><br/><div class="separator" style="clear:both;text-align:left;"></div><br/><div class="separator" style="clear:both;text-align:left;"><u>Scenario 2</u>:</div><br/><div class="separator" style="clear:both;text-align:left;">When launching Workspace Portal externally, the page loads, but internally, users are prompted for username and password (Kerberos fails to login the user)</div><br/><div class="separator" style="clear:both;text-align:left;"></div><br/><div class="separator" style="clear:both;text-align:left;">   - In either case, verify the order of your Access Policies have Kerberos on top, password on bottom. Also verify that the scores are set appropriately, per the screenshots</div><br/><div class="separator" style="clear:both;text-align:left;"></div>
