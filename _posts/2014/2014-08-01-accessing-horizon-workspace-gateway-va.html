---
layout: post
title: Accessing Horizon Workspace Gateway-va URL fails with HTTP 404 Error
date: '2014-08-01T10:02:00.000-07:00'
author: thatvirtualboy
excerpt: "How to resolve this error and configure your appliance properly"
tags:
- database
- postgres
- workspace
- horizon
modified_time: '2017-08-03T10:14:46.616-07:00'
blogger_id: tag:blogger.com,1999:blog-733606464149134140.post-5042239950603263154
blogger_orig_url: https://www.thatvirtualboy.com/2014/08/accessing-horizon-workspace-gateway-va.html
redirect_from: /2014/08/accessing-horizon-workspace-gateway-va.html
---

<span style="font-family:inherit;"><b>Symptoms</b></span><br/><ul style="background-color:white;"><br/>	<li><span style="font-family:inherit;">HTTP 404 Error accessing gateway</span></li><br/>	<li><span style="font-family:inherit;">Service-va logs show something similar to</span><br/><br/><span style="font-family:Courier New, Courier, monospace;">com.vmware.horizon.analytics.exception.HorizonException: Setting up Message Broker connection failed: Connection refused</span></li><br/>	<li><span style="font-family:inherit;">Running </span><span style="font-family:Courier New, Courier, monospace;"><b>df -h</b></span><span style="font-family:inherit;"> on the service-va shows /db as full</span></li><br/></ul><br/><div><span style="font-family:inherit;"><b>Cause</b></span></div><br/><div><span style="font-family:inherit;"> </span></div><br/><div><span style="background-color:white;"><span style="font-family:inherit;">The internal Postgres Database is full and must be expanded. This article does not apply to Workspace implementations that have an external database configured.</span></span></div><br/><div><span style="background-color:white;"><span style="font-family:inherit;"> </span></span></div><br/><div><span style="background-color:white;"><span style="font-family:inherit;"> </span></span></div><br/><div><span style="background-color:white;"><span style="font-family:inherit;"><b>Resolution</b></span></span></div><br/><div><span style="background-color:white;"><span style="font-family:inherit;"> </span></span></div><br/><div><span style="background-color:white;"><span style="font-family:inherit;">To resolve this issue, add a new, large VMDK to the service-va and copy the contents from the old disk to the new one. This process works on service-va VMs with and without internet access.</span></span><br/><div style="background-color:white;"><span style="font-family:inherit;"> </span></div><br/><div style="background-color:white;"><br/><ol style="margin-top:5px;"><br/>	<li><span style="font-family:inherit;">Take a snapshot of the <b>service-va</b></span></li><br/>	<li><span style="font-family:inherit;">Power off the <b>Workspace vApp</b></span></li><br/>	<li><span style="font-family:inherit;">Add a VMDK to the<b> service-va</b><br/><br/>3a. Right click the service-va and choose <b>Edit Settings</b> &gt; <b>Add</b> &gt; <b>Hard Disk</b> and choose Create new virtual disk<br/>3b. Ensure the new disk is at least 30GB in size</span></li><br/>	<li><span style="font-family:inherit;">Power on the service-va VM <b>only</b> and login as <b>root</b></span></li><br/>	<li><span style="font-family:inherit;">Change to run level 1</span><br/><br/><span style="font-family:Courier New, Courier, monospace;">init 1</span><br/><br/><span style="font-family:inherit;">5a. Verify you are in Run Level 1 by typing </span><b><span style="font-family:Courier New, Courier, monospace;">who -r</span></b></li><br/>	<li><span style="font-family:inherit;">Determine the name of the new disk (e.g., /dev/sdxx)</span><br/><br/><span style="font-family:Courier New, Courier, monospace;">fdisk -l</span></li><br/>	<li><span style="font-family:inherit;">Format the new disk with default parameters</span><br/><br/><span style="font-family:Courier New, Courier, monospace;">fdisk /dev/sdxx</span><br/><span style="font-family:Courier New, Courier, monospace;">n</span><span style="font-family:inherit;"> (for new partition)</span><br/><span style="font-family:Courier New, Courier, monospace;">p</span><span style="font-family:inherit;"> (for primary partition)</span><br/><span style="font-family:inherit;">Press Enter to accept Partition Number Default</span><br/><span style="font-family:Courier New, Courier, monospace;">w</span><span style="font-family:inherit;"> (to write changes)</span></li><br/>	<li><span style="font-family:inherit;">Unmount /db (first take note of the device name, e.g., /dev/sdb1)</span><br/><br/><span style="font-family:Courier New, Courier, monospace;">umount /db</span></li><br/>	<li><span style="font-family:inherit;">Copy the contents of /db (in this example, /dev/sdb1) to the new partition</span><br/><br/><span style="font-family:Courier New, Courier, monospace;">dd if=/dev/sdb1 of=/dev/sdxx bs=1024</span><br/><br/><span style="font-family:inherit;">NOTE: This copy operation may take a long time</span></li><br/>	<li><span style="font-family:inherit;">Resize the filesystem using resize2fs</span><br/><br/><span style="font-family:Courier New, Courier, monospace;">e2fsck -f /dev/sdxx<br/>resize2fs /dev/sdxx</span></li><br/>	<li><span style="font-family:inherit;">Mount /dev/sdb1 to /db</span><br/><br/><span style="font-family:Courier New, Courier, monospace;">mount /dev/sdb1 /db</span></li><br/>	<li><span style="font-family:inherit;">Update /etc/fstab to reflect the new partition mounted at /db</span></li><br/>	<li><span style="font-family:inherit;">Run this command to shutdown the service-va </span><br/><br/><span style="font-family:Courier New, Courier, monospace;">shutdown -h now</span></li><br/>	<li><span style="font-family:inherit;">Power on the Workspace vApp.<br/><br/>NOTE: be sure to commit the snapshot previously taken after verifying the environment is stable</span></li><br/></ol><br/></div><br/></div>
