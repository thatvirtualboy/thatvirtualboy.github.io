---
layout: post
title: Working with Horizon Workspace Virtual Users and zmprov
date: '2014-05-21T12:20:00.000-07:00'
author: thatvirtualboy
excerpt: "One nifty feature of Horizon Workspace is the ability to share files and folders with external users. This post explores this feature and how to make it useful."
tags:
- data-va
- user management
- workspace
- horizon
modified_time: '2017-08-03T10:14:46.633-07:00'
blogger_id: tag:blogger.com,1999:blog-733606464149134140.post-7959235311200940644
blogger_orig_url: https://www.thatvirtualboy.com/2014/05/working-with-horizon-workspace-virtual.html
redirect_from: /2014/05/working-with-horizon-workspace-virtual.html
---

One nifty feature of Horizon Workspace is the ability to share files and folders with external users. An "external user" could mean one of two things:<br/><ol><br/>	<li>A directory server user not synced to Horizon Workspace</li><br/>	<li>Someone outside of the enterprise</li><br/></ol><br/><div>An invited user is then created as a <i>virtual user</i> in the Workspace instance. You can find more information about virtual users in the Horizon Workspace Administrator's Guide under User and Group Types: <a href="http://hrzn.ws/1nqI0ZS">http://hrzn.ws/1nqI0ZS</a></div><br/><div></div><br/><div>When a virtual user is created, they are assigned to a hidden Class of Service (COS) called <b>defaultExternal</b>. This class of service comes with its own parameters, notably, all virtual users are defaulted to a file upload size of <b>2GB</b>. You may notice the following error when a virtual user tries to upload a file larger than 2GB:</div><br/><div></div><br/><blockquote class="tr_bq"><span style="background-color:white;color:#434343;font-family:'Courier New';"> exceeds single file maximum upload size 2147483648 bytes</span></blockquote><br/><div></div><br/><div>Additionally, the virtual user will share the quota of the internal user that shared the file with them. So if the <i>inviter</i> has an unlimited quota, files the <i>invitee</i> uploads won't have a negative impact. Conversely, if the <i>inviter</i> has a 10GB limit, any file the <i>invitee</i> uploads will go toward that internal user's 10GB quota.</div><br/><div></div><br/><blockquote class="tr_bq">So how can we increase the virtual user's file upload size limit?</blockquote><br/>Though the defaultExternal COS is hidden in the Administration Console, you can still configure its attributes via the data-va command line.<br/><div style="background-color:white;"><span style="font-family:inherit;"> </span></div><br/><span style="background-color:white;"><span style="font-family:inherit;">To change the upload file size limit for virtual users:</span></span><br/><div style="background-color:white;"><br/><ol style="margin-top:5px;"><br/>	<li><span style="font-family:inherit;">Login to the data-va as <b>root</b></span></li><br/>	<li><span style="font-family:inherit;">Change to the </span><b style="font-family:inherit;">zimbra</b><span style="font-family:inherit;"> user:</span><br/><br/><span style="font-family:Courier New, Courier, monospace;">sudo su - zimbra</span></li><br/>	<li><span style="font-family:inherit;">Switch to the virtual user tenant and modify the upload attribute to the desired file size limit, in bytes:</span><br/><span style="font-family:Courier New, Courier, monospace;"><span style="font-family:Courier New, Courier, monospace;">$ zmprov<br/>prov&gt; st __virtual__<br/>prov&gt; mc defaultExternal hzndataFileUploadMaxSize <i>filesize-in-bytes</i><br/>prov&gt; mc defaultExternal hzndataFileUploadMaxSizePerFile <i>filesize-in-bytes</i><br/>prov&gt; quit<br/><br/></span></span><br/><table class="tr-caption-container" style="margin-left:auto;margin-right:auto;text-align:center;" cellspacing="0" cellpadding="0" align="center"><br/><tbody><br/><tr><br/><td style="text-align:center;"><a style="margin-left:auto;margin-right:auto;" href="https://thatvirtualboy.files.wordpress.com/2014/05/58bcd-virtual.png"><img src="https://thatvirtualboy.files.wordpress.com/2014/05/58bcd-virtual.png" alt="" width="400" height="67" border="0" /></a></td><br/></tr><br/><tr><br/><td class="tr-caption" style="text-align:center;">Increasing virtual user file upload limit to 3GB</td><br/></tr><br/></tbody><br/></table><br/></li><br/>	<li><span style="font-family:inherit;">Restart the service</span><br/><br/><span style="font-family:Courier New, Courier, monospace;">zmcontrol restart</span></li><br/></ol><br/></div><br/><div style="background-color:white;"><span style="font-family:inherit;"><b>Note</b>: to clear the Tenant specifier back to default, use the unsetTenant command:</span></div><br/><blockquote style="background-color:white;border:none;margin:0 0 0 40px;padding:0;"><span style="font-family:Courier New, Courier, monospace;">$ zmprov</span></blockquote><br/><blockquote style="background-color:white;border:none;margin:0 0 0 40px;padding:0;"><span style="font-family:Courier New, Courier, monospace;">prov&gt; ut</span></blockquote><br/>To view all COS, you can use 'gac.' Notice my example below doesn't show defaultExternal because I do not have any virtual users:<br/><div class="separator" style="clear:both;text-align:center;"><a style="margin-left:1em;margin-right:1em;" href="https://thatvirtualboy.files.wordpress.com/2014/05/6f49c-gac.png"><img src="https://thatvirtualboy.files.wordpress.com/2014/05/6f49c-gac.png" alt="" width="400" height="132" border="0" /></a></div><br/>Additionally you can run "<span style="font-family:Courier New, Courier, monospace;">zmprov gac -v"</span> which will show all the configured attributes for each COS. The process outlined above can be used to edit any COS manually. Keep in mind a COS you've created in the Administrator Console GUI will be in the default tentant, not the __virtual__ tenant.<br/><br/>Happy modding!
