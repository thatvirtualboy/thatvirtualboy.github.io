---
layout: post
title: 'Composer Fault: Virtual Machine with Input Specification already exists'
date: '2015-08-12T11:29:00.000-07:00'
author: thatvirtualboy
excerpt: "

If you’ve ever run into this error when composing linked clones with VMware Horizon View Composer, you are very much not alone. This is a common error that ultimately comes down to this: your Composer database already has an entry with that VM name in it. There are 3 ways to fix it depending on your View version and scenario. But first, let’s understand the issue."
tags:
- database
- composer
- vmware
- view
- horizon
- sql
modified_time: '2017-08-03T10:14:47.531-07:00'
blogger_id: tag:blogger.com,1999:blog-733606464149134140.post-7452729704736936684
blogger_orig_url: https://www.thatvirtualboy.com/2015/08/composer-fault-virtual-machine-with.html
redirect_from: /2015/08/composer-fault-virtual-machine-with.html
---

<blockquote>Error During Provisioning: View Composer Fault: Virtual Machine with Input Specification already exists</blockquote><br/>If you've ever run into this error when composing linked clones with VMware Horizon View Composer, you are very much not alone. This is a common error that ultimately comes down to this: your Composer database already has an entry with that VM name in it. There are 3 ways to fix it depending on your View version and scenario. But first, let's understand the issue.<br/><br/>Why does this error happen? Usually due to a delete operation not fully completing. When you click <strong>Delete</strong> for a linked clone in Horizon View, it has to be removed from the View ADAM database, the vCenter Server database, and the Composer database. If the linked clone gets removed from ADAM and VC but fails to be removed from the Composer DB for some reason, when you go to recompose that VM with the same name, you'll see this error.<br/><br/>Let's say the VM is deleted from vCenter only, it's gone from the VCDB and won't show up in vCenter Inventory, but will likely show in View with an error until it's removed from the ADAM database. Once it's removed from ADAM all will <em>appear</em> to be well, until you re-create that linked clone - you'll see the title error.<br/><br/>If you're at the point where the VM is gone from View, meaning you don't see it in View Administrator or in any pool.. <strong>and</strong> you're at the point where the VM isn't anywhere to be found in vCenter, meaning you've done a search and verified the VM has been deleted from the vCenter Inventory, and you're seeing the title error, you should follow the <strong>sviconfig</strong> processes outlined in in <a href="http://kb.vmware.com/kb/2015112" target="_blank">http://kb.vmware.com/kb/2015112 (for View 5.2 and earlier)</a><br/><br/>If you're on View 5.3 or later, use the <strong>ViewDBchck</strong> tool from <a href="http://kb.vmware.com/kb/2118050" target="_blank">http://kb.vmware.com/kb/2118050</a><br/><br/>If you continue to have issues, try running the below scripts on your Composer's SQL database. There are two scripts below: a <span style="text-decoration:underline;">Query</span> script and a <span style="text-decoration:underline;">Delete</span> script. To see if the VM does indeed exist in the Composer DB, run the query script changing the <span style="color:#0000ff;">blue fields </span>to match your VM name and the Composer Database name. This does not modify anything in the DB, just does a search. If it returns data in any tables, then you know that's the issue and you can proceed to use the Delete script (editing the same vm-name and Composer DB name fields as the query script).<br/><br/>I cannot take credit for these scripts, but they have proven invaluable during my time in support! Let me know in the comments if these helped!<br/><h4><span id="0.7309838004601081">Composer</span> SQL DB Scripts</h4><br/><span style="color:#ff0000;">Caution</span>: The scripts are provided as-is. Do not use the scripts without first taking a backup of the composer database to restore in case of a problem. The scripts only work on MS SQL<strong>.</strong><br/><br/>Query Script:<br/><pre>/*This SQL Query will allow FAST access to see if remnant vm's Exist inside the Composer DB*/ <br/>DECLARE @name nvarchar(255) <br/>/*Enter Name Below for VM on line with set [@name='vm_name_here'] */ <br/>set @name='<span style="color:#0000ff;">enter-VM-name-here</span>'<br/>/*Enter Name of VMware View Composer Database for line below [use database_name]*/ <br/>use <span style="color:#0000ff;">Composer-database-name</span><br/> <br/> SELECT *<br/> FROM [dbo].SVI_TASK_STATE<br/> WHERE SIM_CLONE_ID = (SELECT ID FROM [dbo].SVI_SIM_CLONE WHERE VM_NAME like @name)<br/> <br/> SELECT *<br/> FROM [dbo].SVI_VM_NAME<br/> WHERE NAME = @name<br/> <br/> SELECT *<br/> FROM [dbo].SVI_SIM_CLONE<br/> WHERE VM_NAME = @name<br/> <br/> SELECT *<br/> FROM [dbo].SVI_SC_PDISK_INFO<br/> WHERE PARENT_ID = (SELECT ID FROM [dbo].SVI_SIM_CLONE WHERE VM_NAME like @name)<br/> <br/> SELECT *<br/> FROM [dbo].SVI_SC_BASE_DISK_KEYS<br/> WHERE PARENT_ID = (SELECT ID FROM [dbo].SVI_SIM_CLONE WHERE VM_NAME like @name)<br/> <br/> SELECT *<br/> FROM [dbo].SVI_COMPUTER_NAME<br/> WHERE NAME = @name<br/></pre><br/><span style="font-size:small;"><br/>Delete Script:<br/></span><br/><pre>/*!!!DELETES VM FROM SQL DB CAUTION!!!*/ <br/>/*Enter Name Below for VM on line with set [@name='vm_name_here'] */ <br/>DECLARE @name nvarchar(255) <br/>set @name='<span style="color:#0000ff;">enter-VM-name-here</span>'<br/>/*Enter Name of VMware View Composer Database for line below [use database_name]*/ <br/>use <span style="color:#0000ff;">Composer-database-name</span><br/> <br/> DELETE<br/> FROM [dbo].SVI_TASK_STATE<br/> WHERE SIM_CLONE_ID = (SELECT ID FROM [dbo].SVI_SIM_CLONE WHERE VM_NAME like @name)<br/> <br/> DELETE<br/> FROM [dbo].SVI_SC_PDISK_INFO<br/> WHERE PARENT_ID = (SELECT ID FROM [dbo].SVI_SIM_CLONE WHERE VM_NAME like @name)<br/> <br/> DELETE<br/> FROM [dbo].SVI_SC_BASE_DISK_KEYS<br/> WHERE PARENT_ID = (SELECT ID FROM [dbo].SVI_SIM_CLONE WHERE VM_NAME like @name)<br/> <br/> DELETE<br/> FROM [dbo].SVI_SIM_CLONE<br/> WHERE VM_NAME = @name<br/> <br/> DELETE<br/> FROM [dbo].SVI_COMPUTER_NAME<br/> WHERE NAME = @name<br/> <br/> DELETE<br/> FROM [dbo].SVI_VM_NAME<br/> WHERE NAME = @name</pre>
