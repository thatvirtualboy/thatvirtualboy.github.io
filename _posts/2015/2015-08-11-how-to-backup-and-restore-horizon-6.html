---
layout: post
title: How to backup and restore the Horizon 6 View ADAM database
date: '2015-08-11T01:18:00.000-07:00'
author: thatvirtualboy
excerpt: "The ADAM database is the heart and soul of your Horizon View environment. It contains all sorts of great stuff from Pool inventory, to persistent disk assignment, to licensing information. Long story short, if you lose your ADAM database, you straight up lose. Be a winner and backup your database!"
tags:
- database
- vmware
- ADAM
- view
- horizon
modified_time: '2017-08-05T13:01:02.828-07:00'
blogger_id: tag:blogger.com,1999:blog-733606464149134140.post-3845598358165122963
blogger_orig_url: https://www.thatvirtualboy.com/2015/08/how-to-backup-and-restore-horizon-6.html
redirect_from: /2015/08/how-to-backup-and-restore-horizon-6.html
---

The ADAM database is the heart and soul of your Horizon View environment. It contains all sorts of great stuff&nbsp;from Pool inventory, to persistent disk assignment, to licensing information. Long story short, if you lose your ADAM database, you straight up lose. Be a winner and backup your database!<br /><blockquote class="tr_bq">Did you know?</blockquote>View is smart enough to backup its own database. If you jump onto one of your Connection Servers and navigate to <strong>C:\ProgramData\VMware\VDM\backups</strong> you should see a slew of .LDF files.<br /><br /><a href="https://thatvirtualboy.files.wordpress.com/2015/08/screen-shot-2015-08-10-at-8-37-56-pm.png"><img alt="Screen Shot 2015-08-10 at 8.37.56 PM" class="alignnone size-medium wp-image-352" height="145" src="https://thatvirtualboy.files.wordpress.com/2015/08/screen-shot-2015-08-10-at-8-37-56-pm.png?w=300" width="300" /></a><br /><br />These are your automated backups. You can see when your last backup ran by launching the Horizon View Administration page and navigating to <em>View Configuration &gt; Servers &gt; Connection Servers</em> and looking at the <strong>Last Backup</strong> column.<br /><blockquote class="tr_bq">Like any good admin, you take your own backups</blockquote>You don't want to rely <em>only</em> on these backups. They are local to the Connection Server after all, causing a single point of failure if you lose that VM for any reason. You can always copy the latest LDF to another server somewhere, or you can take a manual backup of the current state of the ADAM database. This is extremely simple and highly recommended!<br /><br />NOTE:&nbsp;You'll also want to know what your <strong>data recovery password</strong> is before you can restore any backup you have. If you don't know what it is, you can change it by launching <strong>View Administrator</strong> &gt; <strong>View Configuration</strong> &gt; <strong>Global Settings</strong> &gt; <strong>Security</strong> &gt;<strong><em> Change data security password</em></strong><br /><br /><a href="https://thatvirtualboy.files.wordpress.com/2015/08/screen-shot-2015-08-11-at-7-49-29-am.png"><img alt="Screen Shot 2015-08-11 at 7.49.29 AM" class="alignnone size-medium wp-image-362" height="157" src="https://thatvirtualboy.files.wordpress.com/2015/08/screen-shot-2015-08-11-at-7-49-29-am.png?w=300" width="300" /></a><br /><br /><h3>Taking a manual backup of the ADAM database</h3><br />Before we take the backup, you might be asking, "Do I need to take a backup of <em>all</em> my replica Connection Servers' databases?" The short answer is no, you need only take one backup. This is due to how the restore procedure is carried out (outlined below).<br /><ol><br /><li>First off, ensure your View environment isn't currently creating or deleting any VMs and disable all pools from provisioning<br /><ol><br /><li>Launch <strong>View Administrator</strong> and navigate to <strong>View Configuration</strong> &gt; <strong>Servers</strong> &gt; <strong>vCenter Server</strong></li><br /><li>Click <strong>Disable Provisioning<br /><a href="https://thatvirtualboy.files.wordpress.com/2015/08/screen-shot-2015-08-10-at-9-39-25-pm.png"><img alt="Screen Shot 2015-08-10 at 9.39.25 PM" class="alignnone size-medium wp-image-354" height="121" src="https://thatvirtualboy.files.wordpress.com/2015/08/screen-shot-2015-08-10-at-9-39-25-pm.png?w=300" width="300" /></a></strong></li></ol></li><br /><li>Now get a console to&nbsp;your <strong>Connection Server</strong></li><br /><li>Launch an elevated Windows Command Prompt</li><br /><li>Navigate to the directory you want the backup to reside temporarily and run<br /><pre>vdmexport &gt; vdmconfig.ldf</pre><br /><a href="https://thatvirtualboy.files.wordpress.com/2015/08/screen-shot-2015-08-10-at-9-44-05-pm.png"><img alt="Screen Shot 2015-08-10 at 9.44.05 PM" class="alignnone size-medium wp-image-355" height="23" src="https://thatvirtualboy.files.wordpress.com/2015/08/screen-shot-2015-08-10-at-9-44-05-pm.png?w=300" width="300" /></a></li><br /><li>This created an <strong>LDF</strong> file on my desktop. You can compare its size to that of your automated backups (they should be similar)<br /><a href="https://thatvirtualboy.files.wordpress.com/2015/08/screen-shot-2015-08-10-at-9-46-31-pm.png"><img alt="Screen Shot 2015-08-10 at 9.46.31 PM" class="alignnone size-medium wp-image-356" height="165" src="https://thatvirtualboy.files.wordpress.com/2015/08/screen-shot-2015-08-10-at-9-46-31-pm.png?w=300" width="300" /></a></li><br /><li>Let's move this LDF&nbsp;to a backup file share for safe keeping&nbsp;and&nbsp;you've got yourself a current ADAM database backup!</li></ol>It should be noted that in the event of an actual outage that requires a restore of the ADAM database, best practice is to also restore the <strong>Composer</strong> and <strong>vCenter databases</strong> from the same time frame of the ADAM backup. Otherwise the VM inventory of the databases could be out of sync causing orphaned VMs and other missing data that could take additional downtime to recover from.&nbsp;The backup and restore of Composer and vCenter are generally quite simple as they follow&nbsp;simple SQL backup and restore procedures. It goes without saying, however, that&nbsp;whatever database you're using, refer to that database vendor for proper backup/restore procedures.<br /><br /><h3>Restoring an ADAM database LDF backup</h3><br />When it comes time to restore the ADAM database (preferably after Composer and vCenter databases have been restored) the simplest way to get View back up is to reinstall the Connection Server service.<br /><ol><br /><li>Uninstall the <strong>VMware Horizon View Connection Server</strong> software (from Add-Remove Programs / Programs and Features / appwiz.cpl / etc)</li><br /><li>Uninstall the <strong>AD LDS Instance VMwareVDMDS</strong> software (This is the ADAM instance which gets installed with View)<br /><a href="https://thatvirtualboy.files.wordpress.com/2015/08/screen-shot-2015-08-11-at-7-39-00-am.png"><img alt="Screen Shot 2015-08-11 at 7.39.00 AM" class="alignnone size-medium wp-image-360" height="107" src="https://thatvirtualboy.files.wordpress.com/2015/08/screen-shot-2015-08-11-at-7-39-00-am.png?w=300" width="300" /></a></li><br /><li>Remove the <strong>ADLDS Role</strong> from <strong>Server Configuration<br /><a href="https://thatvirtualboy.files.wordpress.com/2015/08/screen-shot-2015-08-11-at-7-54-56-am.png"><img alt="Screen Shot 2015-08-11 at 7.54.56 AM" class="alignnone size-medium wp-image-363" height="211" src="https://thatvirtualboy.files.wordpress.com/2015/08/screen-shot-2015-08-11-at-7-54-56-am.png?w=300" width="300" /></a></strong></li><br /><li>Reboot the server</li><br /><li>Install the Connection Server software<br /><ol><br /><li>Be sure to choose <strong>Standard Server</strong> during install</li><br /><li>If you have replicas in the environment, we'll deal with those later.</li></ol></li><br /><li>Decrypt the LDF backup you took earlier by&nbsp;launching command prompt and typing<br /><pre> vdmimport -d -f MyEncryptedexport.LDF &gt; MyDecryptedexport.LDF</pre></li><br /><li>This will prompt you to enter your data recovery password.</li><br /><li>Now you can import the database into the fresh ADAM instance by typing<br /><pre> vdmimport -f VDMConfig.LDF</pre></li><br /><li>If this is your only Connection Server, you've successfully completed the database restore and View should be fully operational. If you have any replicas in the environment, these servers will need to be re-installed as replicas. Follow the same <em>uninstall</em>&nbsp;process from steps 1 - 4 and ensure you choose <strong>Replica</strong> during install.</li></ol><br />For more information, check out VMware's KB for performing an <a href="http://kb.vmware.com/kb/1008046" target="_blank">end-to-end backup.</a>
