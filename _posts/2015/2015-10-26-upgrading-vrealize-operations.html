---
layout: post
title: Upgrading vRealize Operations
date: '2015-10-26T03:44:00.000-07:00'
author: thatvirtualboy
excerpt: "Guest Post Ahead! vRealize Operations (formerly known as vCenter Operations Manager) is an indispensable tool for monitoring a VMware environment. The upgrade process between recent versions is riddled with pitfalls, however. Here, I will cover the process and make notes of all the gotchas so that you can have as smooth of an experience as possible."
tags:
- upgrades
- update
- vcops
- vcenter operations
- vrops
- management
- upgrade
- patches
- vrealize operations
modified_time: '2017-08-03T10:15:22.948-07:00'
blogger_id: tag:blogger.com,1999:blog-733606464149134140.post-4760721911985212313
blogger_orig_url: https://www.thatvirtualboy.com/2015/10/upgrading-vrealize-operations.html
redirect_from: /2015/10/upgrading-vrealize-operations.html
---

vRealize Operations (formerly known as vCenter Operations Manager) is an indispensable tool for monitoring a VMware environment. The upgrade process between recent versions is riddled with pitfalls, however. Here, I will cover the process and make notes of all the gotchas so that you can have as smooth of an experience as possible.<br/><br/>The upgrade process goes from 5.x -&gt; 5.8.1+ -&gt; 6.0.x -&gt; 6.2.<br/><h2>Upgrading from 5.x to 5.8.5</h2><br/><b>Prerequisites and Common Pitfalls:</b><br/><ul><br/>	<li>You should change your admin password before attempting the upgrade. New security policies that come with this upgrade will expire older passwords for admin. It must be a complex password that you have not used before. <a href="http://kb.vmware.com/kb/2013358" target="_blank">http://kb.vmware.com/kb/2013358</a></li><br/>	<li>You should ensure that you have a good amount of free disk space on the UI and Analytics VMs. You can check this with “df -h” on the command line.<br/><ul><br/>	<li>Appliances that were originally deployed as 5.6 and earlier had a smaller root partition that may get filled by the update. If you run into any issues caused by this, you can follow <a href="http://kb.vmware.com/kb/2074688" target="_blank">http://kb.vmware.com/kb/2074688</a></li><br/>	<li>If the /data partition is &gt;85% full on either VM, you should add a disk and reboot. Boot-time scripts will handle data volume expansion onto new disks for you.</li><br/></ul><br/></li><br/></ul><br/><b>Steps to Upgrade:</b><br/><ol><br/>	<li>Take a snapshot of both VMs.</li><br/>	<li>Follow the instructions in the release notes for the upgrade at <a href="https://www.vmware.com/support/vcops/doc/vcops-585-vapp-release-notes.html#upgrade" target="_blank">https://www.vmware.com/support/vcops/doc/vcops-585-vapp-release-notes.html#upgrade</a></li><br/>	<li>After ensuring that you can get in to the UI, delete the snapshots.</li><br/></ol><br/><h2>Migrating data from 5.8.1+ to 6.0.x</h2><br/><b>Prerequisites and Common Pitfalls:</b><br/><ul><br/>	<li>You must be migrating from version 5.8.1 or higher. The data migration will be more reliable with version 5.8.5, but is known to work with all versions from 5.8.1+.</li><br/>	<li>You must have forward and reverse DNS entries in place for your source 5.8.1+ VMs, as well as for every node in your new 6.0.x cluster.</li><br/>	<li>Please size your nodes appropriately per the handy Excel spreadsheet attached to the bottom of <a href="http://kb.vmware.com/kb/2130551" target="_blank">http://kb.vmware.com/kb/2130551</a></li><br/>	<li>When naming and addressing your version 6 nodes, please note:<br/><ul><br/>	<li>Node and host names can not have underscores</li><br/>	<li>The roles of a node are subject to change, so naming a node according to a role may get confusing in the future.</li><br/>	<li>Node names are extremely difficult to change, and attempting to do so is quite likely to break things.</li><br/></ul><br/></li><br/>	<li>All nodes of a vROps 6 cluster (with the exception of remote collectors) must be on the same physical LAN (&gt;1MS latency <span style="text-decoration:underline;"><strong><i>will</i></strong></span> cause problems) and must not be separated by a firewall.</li><br/>	<li>You should change your admin password on 5.8.1+ before attempting the migration. An expired password is common, sometimes difficult to identify, and will cause vague errors. It must be a complex password that you have not used before. <a href="http://kb.vmware.com/kb/2013358" target="_blank">http://kb.vmware.com/kb/2013358</a></li><br/>	<li>If you suspect that performance may be an issue, stopping DT calculation and new data collection on the 5.8.1+ appliance will improve the speed of the data migration greatly. <a href="http://kb.vmware.com/kb/2040008" target="_blank">http://kb.vmware.com/kb/2040008</a></li><br/>	<li>Although it is not supposed to be an issue anymore, there are some cases where DNS resolution does not work properly and this KB may still be necessary: <a href="http://kb.vmware.com/kb/2100944" target="_blank">http://kb.vmware.com/kb/2100944</a></li><br/></ul><br/><b>Steps to upgrade:</b><br/><ol><br/>	<li>Install the latest version of 6.0.x per the documentation at <a href="http://pubs.vmware.com/vrealizeoperationsmanager-6/index.jsp" target="_blank">http://pubs.vmware.com/vrealizeoperationsmanager-6/index.jsp</a></li><br/>	<li>After you bring your cluster online, you will be presented with a wizard. Don’t select the option for importing data or enter a license key when it asks you. Even though you are going to import data and probably have a license key, it is more reliable to do these things after the setup wizard completes in my experience.</li><br/>	<li>Go to Administration&gt;Solutions and select the tab called “Import Data”</li><br/>	<li>Follow the prompts for importing data.</li><br/>	<li>Once the import is complete, you can run the old 5.8 instance in parallel with 6.0 until you are comfortable with the results, then delete the 5.8 instance when you are ready.</li><br/></ol><br/><h2>Upgrading from 6.x to 6.2</h2><br/><b>Prerequisites and Common Pitfalls:</b><br/><ul><br/>	<li>Because the upgrade process will convert two of the databases to another type and not delete the source data sets (in case of issues), you must plan for this extra disk space to be consumed.<br/><ul><br/>	<li>To calculate how much extra space will be consumed by the database conversion, you can log in to the shell of each data/master/replica node and run:<br/>$  du -sch $STORAGE/db/vcops/*xdb* | tail -n1<br/>You should add around 10% to this value to be safe, which is in addition to the 15% total free space you ought to maintain on /storage/db for general stability.</li><br/>	<li>To check how much total free space is available on the system, run:<br/>$ df -h $STORAGE/db</li><br/></ul><br/></li><br/>	<li>If you have nodes that are separated by slow, latent, or unreliable links, the update may time out when the master node pushes the update out to them. This will be apparent if the upgrade fails without presenting you with an EULA. You can pre-stage the update pak files to work around this: <a href="http://kb.vmware.com/kb/2127895" target="_blank">http://kb.vmware.com/kb/2127895</a></li><br/>	<li><del>There are a few instances where upgrading to 6.2 or 6.2a will take an indefinite amount of time to complete. If your upgrade takes more than 24 hours to complete, please contact VMware support. They will be able to help finish the upgrade.</del><br/>This is fixed in 6.2.1.</li><br/>	<li>These should no longer be necessary, but I'll leaving them here for reference:<br/><ul><br/>	<li>Previous updates, patches and add-on Management Packs may cause issues if their files still linger in your update queue. To avoid issues with this, you should log in to each node via console or SSH and move the pak files in “$STORAGE/db/casa/pak/dist_pak_files/” somewhere else.</li><br/>	<li>Large database blobs from a previous data migration may choke the update process. <a href="http://kb.vmware.com/kb/2132479" target="_blank">http://kb.vmware.com/kb/2132479</a></li><br/>	<li>The cluster state files may have some malformed data in them. <a href="http://kb.vmware.com/kb/2106950">http://kb.vmware.com/kb/2106950</a></li><br/>	<li>Expired projects may cause an upgrade failure when going from 6.1 to 6.2 <a href="http://kb.vmware.com/kb/2136536" target="_blank">http://kb.vmware.com/kb/2136536</a></li><br/>	<li>There may be a malformed upgrade state file from previous versions. You should remove this before upgrading. <a href="http://kb.vmware.com/kb/2120616" target="_blank">http://kb.vmware.com/kb/2120616</a></li><br/>	<li>I have a script that can automate many of the above tasks and more at<br/><a href="https://github.com/nakedhitman/vrops-cluster-repair" target="_blank">https://github.com/nakedhitman/vrops-cluster-repair</a></li><br/></ul><br/></li><br/></ul><br/><b>Steps to upgrade:</b><br/><ol><br/>	<li>Take a snapshot of all your nodes.</li><br/>	<li><strong>Install the OS Update pak file. </strong>(This step is very important and <span style="text-decoration:underline;">must be done before the application update</span>.)</li><br/>	<li>Install the Application Update pak file.<br/><ol><br/>	<li>Ensure that you check both the boxes so that the “Reset out of the box content” option is selected. If you do not do this, some parts of the system may not be upgraded. This will not affect custom dashboards or other user-created content. Only the content that ships with the system that you ought not to have changed will be affected. If you do have customizations to the built-in content, you can clone them to preserve your changes.</li><br/></ol><br/></li><br/>	<li>Log in to the product UI as admin and ensure that your dashboards, adapter instances, and other data are present and working as expected.<br/><ol><br/>	<li>If it makes you go through the first run setup wizard again: don’t panic, its probably fine. Just choose evaluation mode and complete the wizard. Everything should be there when it’s complete. <a href="http://kb.vmware.com/kb/2132452" target="_blank">http://kb.vmware.com/kb/2132452</a></li><br/>	<li>If you end up with vCenter adapter instances that cannot be configured, missing dashboards or licenses, or end up loosing historical data, you should revert your snapshot and tell VMware about it immediately. If you don’t have a support contract, then make some noise on the communities site. VMware pays attention to this stuff and wants to prevent it from happening.</li><br/></ol><br/></li><br/>	<li>Once you’re sure that everything is running OK, delete the snapshots.</li><br/></ol><br/><h2>Conclusion</h2><br/>Although the upgrade process is a bit of an ordeal that can consume a good chunk of time, the features, stability, and performance of a <i>successful</i> upgrade really are worth it. VMware is working hard to make it better, and does listen to the things that are said on the <a href="https://communities.vmware.com/community/vmtn/vcenter/vcops" target="_blank">communities site</a> should you have any issues.
