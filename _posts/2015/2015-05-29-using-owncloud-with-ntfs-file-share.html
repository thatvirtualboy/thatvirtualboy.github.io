---
layout: post
title: Using OwnCloud with an NTFS file share [Updated]
date: '2015-05-29T08:15:00.000-07:00'
author: thatvirtualboy
excerpt: "Trying to use NTFS with your OwnCloud server? You may be running into some challenges."
tags:
- linux
- bacon
- cloud
- workstation
- owncloud
modified_time: '2017-08-05T13:05:13.516-07:00'
blogger_id: tag:blogger.com,1999:blog-733606464149134140.post-5230417521442154818
blogger_orig_url: https://www.thatvirtualboy.com/2015/05/using-owncloud-with-ntfs-file-share.html
redirect_from: /2015/05/using-owncloud-with-ntfs-file-share.html
---

Trying to use NTFS with your OwnCloud server? You may be running into some challenges.<br /><br><h3>My setup</h3>I'm running OwnCloud 8 server in a Linux Mint VM (VMware Workstation) for personal use. It uses a USB 3.0 2TB drive formatted as NTFS and it works pretty darn well.<br /><br />I won't be going over how to setup OwnCloud server in Ubuntu - if you're interested in that, <a href="http://www.noobslab.com/2015/01/install-owncloud-in-ubuntulinux-mint.html" target="_blank">here's a great guide by our friends over at Noobs Lab</a>&nbsp;(I highly recommend using MySQL or any other database solution over the included SQLite.. you will have major performance issues if you use SQLite)<br /><br />The reason I wanted to go this route with my configuration is because I can have a small (~20GB) Ubuntu Server utilizing a larger external drive that can be easily read by both my Linux Server, as well as my Windows host machine. Smaller VMs means more internal space on my host machine!<br /><br />At first I thought I could simply "pass through" my drive to the VM for hosting my personal cloud, similar to how I <a href="http://thatvirtualboy.com/2014/08/06/plex-server-virtual-machines-and-google-chromecast/" target="_blank">configured my Plex Server</a>.&nbsp;Unfortunately the system was having trouble recognizing the pass-through (even though file syncing actually worked when manually copying files to the share.. very strange). I would see an error similar to the one below:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://thatvirtualboy.files.wordpress.com/2015/05/dce74-capture.png" style="margin-left: 1em; margin-right: 1em;"><img alt="" border="0" height="165" src="/assets/images/wordpress/2015/05/dce74-capture.png"/></a></div><br /><div class="separator" style="clear: both; text-align: center;"></div><br /><div class="separator" style="clear: both; text-align: center;"><i>Data directory (/mnt/hgfs/owncloud/data) is readable by other users.</i></div><br /><div class="separator" style="clear: both; text-align: center;"><i>Please change the permissions to 0770 so that the directory cannot be listed by other users.</i></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;">I was unable to change the permissions on the NTFS mount when it was configured this way.</div><br /><div class="separator" style="clear: both; text-align: left;">Through researching the issue and the options available, I decided the easiest method to continue to use NTFS with this setup is to create a Windows share on my owncloud data folder, and mount it as a CIFS share to the OwnCloud server.</div><h3><br>What you'll need</h3><div><ol><li>Host machine with VMware Workstation (or similar software)</li><br /><li>OwnCloud server in a Ubuntu-based Virtual Machine (~20gb vm)</li><br /><li>External USB 3.0 Drive formatted as NTFS</li><br /><li>Patience and determination!</li></ol></div><div class="separator" style="clear: both; text-align: left;">On to the how-to:</div><div></div><br /><div><span style="color: maroon;">I should preface this section: this setup works for me and my needs, which is a single-user personal setup. This is <u>not</u> recommended for a multi-user, production configuration.</span></div><ol><br /><li>Remove any VMware Workstation-based pass through you have configured for the NTFS drive. This may require you to power off the VM and delete the pass through.<br /><a href="https://thatvirtualboy.files.wordpress.com/2015/05/1b0bb-capture.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img alt="" border="0" height="144" src="/assets/images/wordpress/2015/05/1b0bb-capture.png"/></a></li><br /><li>On the host side (in my case, <del>Windows 8.1</del> Windows 10) create a local user account dedicated for owning the share. This will be used later when we mount it to Linux. In my example, <b>ocadmin</b><br /><a href="https://thatvirtualboy.files.wordpress.com/2015/05/f0409-capture.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img alt="" border="0" height="235" src="/assets/images/wordpress/2015/05/f0409-capture.png" /></a></li><br /><li>On the host side, create a normal share on the folder you'll be using as the owncloud data folder (right click, properties, Sharing tab, Share...) and give full permissions to the user account you created. This should create a share location similar to <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">\\hostname\data<br /><a href="https://thatvirtualboy.files.wordpress.com/2015/05/9528c-capture.png" style="font-family: 'Times New Roman'; margin-left: 1em; margin-right: 1em; text-align: center;"><img alt="" border="0" height="320" src="/assets/images/wordpress/2015/05/9528c-capture.png" /></a></span></li><br /><li><span style="font-family: inherit;">Now login to the OwnCloud server, edit your </span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">/etc/fstab</span><span style="font-family: inherit;">&nbsp;using </span><i style="font-family: inherit;">vi</i><span style="font-family: inherit;">, or </span><i style="font-family: inherit;">gedit</i><span style="font-family: inherit;"><span style="font-family: inherit;"><span style="font-family: inherit;">, or what have you. At the bottom of the file, add an entry that looks like this:</span></span></span><span style="color: green;"><span style="color: green;"><span style="color: green;">//&lt;ip of host&gt;/data &lt;/location/to/put/share&gt; cifs uid=www-data,username=ocadmin,password=&lt;your password&gt;,iocharset=utf8,file_mode=0770,dir_mode=0770,sec=ntlm 0 0</span></span></span><strong>Tips:</strong><span style="color: maroon;">&lt;ip of host&gt;</span> This is the IP of the machine running Workstation<br /><span style="color: maroon;">&lt;/location/to/put/share&gt;</span>&nbsp;This is where the share will be mounted to the Linux OwnCloud server. This could be your Linux Home folder, desktop, documents folder.. the options are endless... endless<br /><span style="color: maroon;">www-data</span> is the default OwnCloud server account running the owncloud service<br /><span style="color: maroon;">ocadmin/password</span> is the local host machine account we careated earlier</li><br /><li>Now we need to make OwnCloud aware of the location we want it to use for storing files. Edit the config.php file to include the you typed above.sudo vi /var/www/owncloud/config/config.phpModify the 'datadirectory'&nbsp;field to your new location so it reads something like:'datadirectory' =&gt; '/var/www/owncloud/data',<br /><br />Save and close this file.</li><br /><li>Now in the terminal, type <strong>sudo mount -a</strong> and ensure there are no errors mounting the share we configured in fstab.</li><br /><li>Give your Linux system a quick reboot and you should no longer receive the errors at the top of this post when accessing your OwnCloud URL.</li></ol><span style="color: red;">[Update, May 13 2016]</span><br /><br />If you've followed this method and are planning on an upgrade from OC8 to OC9, be sure to read the <a href="https://doc.owncloud.org/server/9.0/admin_manual/installation/installation_wizard.html#strong-perms-label" target="_blank">OC Upgrade documentation</a> very carefully as it states, "When using an NFS mount for the data directory, do not change its ownership from the default. The simple act of mounting the drive will set proper permissions for ownCloud to write to the directory. Changing ownership as above could result in some issues if the NFS mount is lost."<br /><div></div><br /><div>Did this post help you? Let me know in the comments!</div>
