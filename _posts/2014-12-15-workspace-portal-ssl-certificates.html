---
layout: post
title: Workspace Portal SSL Certificates [updated for vIDM]
date: '2014-12-15T11:07:00.000-08:00'
author: thatvirtualboy
excerpt: "Configuring CA signed SSL certs in Workspace Portal and VIDM."
tags:
- vmware
- workspace portal
- ssl
- workspace
- certs
- vIDM
- certificates
modified_time: '2017-08-03T10:14:47.186-07:00'
blogger_id: tag:blogger.com,1999:blog-733606464149134140.post-1696891177268559012
blogger_orig_url: https://www.thatvirtualboy.com/2014/12/workspace-portal-ssl-certificates.html
---

<h4><span style="color:#ff0000;">[Updated September 2015]</span></h4><br/>The below process was originally written for Workspace Portal 2.1 and <span style="text-decoration:underline;">can be applied to vIDM</span>. Any differences in process has been placed appropriately within the post.<br/><br/><hr /><br/><br/>VMware strongly recommends that you configure SSL certificates that are signed by a valid Certificate Authority (CA) for use by Workspace Portal.<br/><br/>A default SSL server certificate is automatically generated when the Workspace appliance is installed. Although you can use the default, self-signed certificate for testing purposes, it should be replaced as soon as possible for a production environment. The default certificate is not signed by a CA. Use of certificates that are not signed by a CA can allow untrusted parties to intercept traffic by masquerading as your server.<br/><br/>If you deploy <span id="GUID-B76761BF-4B12-4CD5-9366-B0A1A2BF2A8B__PRODUCTNAME_3D59143A3C31483D98AC3FFB4F99418B">Workspace</span> with the self-signed SSL certificate, the <span id="GUID-B76761BF-4B12-4CD5-9366-B0A1A2BF2A8B__PRODUCTNAME_3D59143A3C31483D98AC3FFB4F99418B">Workspace</span> root CA certificate must be available as a trusted CA for any client who accesses <span id="GUID-B76761BF-4B12-4CD5-9366-B0A1A2BF2A8B__PRODUCTNAME_3D59143A3C31483D98AC3FFB4F99418B">Workspace</span>. The clients can include end user machines, load balancers, proxies, and so on. You can download the <span id="GUID-B76761BF-4B12-4CD5-9366-B0A1A2BF2A8B__PRODUCTNAME_3D59143A3C31483D98AC3FFB4F99418B">Workspace</span> root CA from <cite id="GUID-B76761BF-4B12-4CD5-9366-B0A1A2BF2A8B__CITE_F142CDCD2E574E1B8DB645C56250C174">https://<var id="GUID-B76761BF-4B12-4CD5-9366-B0A1A2BF2A8B__VARNAME_49BA81C0B95A49A395BE366EB7AD27D6" class="varname" style="font-weight:inherit;">workspacehostname.com</var>/horizon_workspace_rootca.pem</cite>.<br/><br/>Before you can import a certificate, you must generate a Certificate Signing Request (CSR) and obtain a valid, signed certificate from a CA. If the CSR is not generated according to the example procedure described in this document, the resulting certificate and its private key must be available in a PEM format file.<br/><br/>There are many ways to obtain SSL certificates from a CA. This post shows how to use OpenSSL to generate a CSR and make a certificate available to Workspace Portal. You can use another method if you are familiar with the required tools, and they are installed on your server.<br/><br/>If your organization provides you with SSL certificates that are signed by a CA, you can use these certificates. If these certificates are not in the necessary PEM format, you can convert them with third party tools, such as that from <a href="https://www.sslshopper.com/ssl-converter.html" target="_blank">SSLShopper</a><br/><br/>To make a certificate available to Workspace Portal 2.1, three things must be done:<br/><ol><br/>	<li>Create a configuration file</li><br/>	<li>Generate a certificate signing request (CSR) from the configuration file</li><br/>	<li>Send the signing request to a CA</li><br/></ol><br/><div>When the CA returns the certificate, you must import the signed certificate into Workspace Portal using the Appliance Configurator. If using a Load Balancer, you must import the signed certificate onto to the Load Balancer per the vendor's instructions, and then install the Load Balancer's Root CA Certificate on Workspace Portal.</div><br/><h3>Creating the configuration file</h3><br/><div>We will be using OpenSSL as it comes pre-installed on the Workspace Portal appliance, though you can use OpenSSL on a wide variety of operating systems,<a href="http://slproweb.com/products/Win32OpenSSL.html." target="_blank"> including Windows</a>. The below instructions will be assuming a Linux based OS.</div><br/><div></div><br/><div><br/><ol><br/>	<li>Login to your system that has OpenSSL installed (if using the Workspace appliance, either open a vSphere console, or SSH into the appliance).</li><br/>	<li>Create a folder to perform the certificate work in:<span style="font-family:Courier New, Courier, monospace;">mkdir certificates<br/>cd certificates</span></li><br/>	<li>Copy openssl.cnf into that folder<span style="font-family:Courier New, Courier, monospace;">cp /etc/ssl/openssl.cnf openssl.cnf</span><br/><a style="margin-left:1em;margin-right:1em;text-align:center;" href="https://thatvirtualboy.files.wordpress.com/2014/12/37954-1.png"><img src="https://thatvirtualboy.files.wordpress.com/2014/12/37954-1.png" alt="" width="320" height="198" border="0" /></a></li><br/>	<li>Edit the file using vi.<br/><span style="font-family:Courier New, Courier, monospace;">vi openssl.cnf<br/></span>The part of the file you have to modify in order to generate a certificate request is highlighted below. For a wildcard certificate request, subjectAltName is not relevant.</li><br/></ol><br/><div><br/><div>[ req_distinguished_name ] # Change these settings for your</div><br/><div>environment</div><br/><div><span style="color:red;">countryName_default = US</span></div><br/><div><span style="color:red;">stateOrProvinceName_default = Colorado</span></div><br/><div><span style="color:red;">localityName_default = Broomfield</span></div><br/><div><span style="color:red;">0.organizationName_default = EUC</span></div><br/><div><span style="color:red;">organizationalUnitName_default = IT</span></div><br/></div><br/></div><br/><div><span style="color:red;"> </span></div><br/><div>[ CA_defaults ] # Change sha1 to sha512</div><br/><div><span style="color:red;">default_md = sha512</span></div><br/><div><span style="color:red;"> </span></div><br/><div>[ req ]</div><br/><div><span style="color:red;">default_bits = 2048</span></div><br/><div></div><br/><div><br/><div>[ v3_req ]</div><br/><div>basicConstraints = CA:FALSE</div><br/><div>keyUsage = nonRepudiation, digitalSignature, keyEncipherment,</div><br/><div>dataEncipherment</div><br/><div>extendedKeyUsage = serverAuth, clientAuth</div><br/><div><span style="color:red;">subjectAltName = DNS: ext-con.company.com, DNS:</span></div><br/><div><span style="color:red;">view.company.com, DNS: gtw.company.com, DNS:</span></div><br/><div><span style="color:red;">services.company.com </span>Since we will request a wildcard</div><br/><div>certificate these additional hostnames are not of importance.</div><br/></div><br/><div></div><br/><div>NOTE: We are not setting the commonName here, we will do that below when prompted. If you plan to <b>not</b> use a wildcard, consider adding your subjectAltNames</div><br/><div></div><br/><div><br/><br/>Save this file<br/><br/><span style="font-family:Courier New, Courier, monospace;">:wq</span><br/><br/></div><br/><h3><span style="font-family:inherit;">Generating the certificate request</span></h3><br/><div><br/><ol><br/>	<li>Create your CSR and private key by typing<span style="font-family:Courier New, Courier, monospace;">openssl req -new -nodes -out rui.csr -keyout rui.key -config openssl.cnf</span><br/><a style="margin-left:1em;margin-right:1em;text-align:center;" href="https://thatvirtualboy.files.wordpress.com/2014/12/dd105-2.png"><img src="https://thatvirtualboy.files.wordpress.com/2014/12/dd105-2.png" alt="" width="320" height="221" border="0" /><br/></a></li><br/>	<li>Accept the default values you configured on the .cnf file. When prompted for the common name, enter either the wildcard value, or the external name you will be referencing for Workspace from outside your network (e.g., portal.acme.com)Make sure you store your private key in a safe place. Without it, your certificate becomes useless.</li><br/>	<li>Congrats! You've successfully created a certificate signing request for a sha512 hashed, 2048-bit encrypted certificate. Now to get this CSR signed.</li><br/></ol><br/><h3>Send the CSR to a Certificate Authority (CA) for signing</h3><br/></div><br/><div>Your CSR must be submitted to a CA in order to be issued a usable certificate. You can use either a <a href="https://www.sslshopper.com/certificate-authority-reviews.html" target="_blank">publicly trusted CA</a> (GoDaddy, DigiCert, etc), or an internal CA your company has, or perhaps one you even built yourself. If you don't go with a publicly trusted CA, <a href="https://www.google.com/search?q=how+to+setup+a+ca&amp;oq=how+to+setup+a+ca&amp;aqs=chrome..69i57j0l5.3738j0j7&amp;sourceid=chrome&amp;es_sm=93&amp;ie=UTF-8" target="_blank">there are plenty of options for setting up your own CA</a>. The important thing to ensure is when you've been issued your certs, download them as <b>Base 64 encoded</b>.</div><br/><h3>Installing the certificate</h3><br/>Once you've obtained your certificate(s), it's time to put it together so that Workspace can understand it. Workspace needs the certificate to be in PEM format. PEM is a widely used format these days because of its flexibility and ease of use. PEM allows you to bundle multiple certificates into a single file which a server can read and understand. This is important for Workspace. If you need to convert the certs you received to PEM format, you can use the link provided earlier in this post, or even use OpenSSL. Workspace needs at least 2 certs (usually 3) which you should have received from your CA.<br/><br/>Server (host) cert<br/>Intermediate cert(s)<br/>Root cert<br/><br/>This is how we will build our PEM file, with the host cert on top, any intermediate certs in the middle, and root on the bottom:<br/><div><span style="color:#ff6600;">-----BEGIN CERTIFICATE-----</span><br/><span style="color:#ff6600;">(Your Primary SSL certificate)</span><br/><span style="color:#ff6600;">-----END CERTIFICATE-----</span><br/><span style="color:#339966;">-----BEGIN CERTIFICATE-----</span><br/><span style="color:#339966;">(Your Intermediate certificate)</span><br/><span style="color:#339966;">-----END CERTIFICATE-----</span><br/><span style="color:#0000ff;">-----BEGIN CERTIFICATE-----</span><br/><span style="color:#0000ff;">(Your Root certificate)</span><br/><span style="color:#0000ff;">-----END CERTIFICATE----</span></div><br/>It's important to use a text editor like WordPad or Notepadd++ when handling these PEM files. Using something like Notepad can cause formatting issues that we certainly want to steer clear of.<br/><br/>Once you've built your new PEM file containing the components above, it's time to install it. If you don't have a load balancer or reverse proxy server in place, you can install this right on Workspace. This is considered <strong>terminating SSL on the Workspace Appliance</strong>.<br/><br/><span style="text-decoration:underline;">To do this on Workspace Portal:</span><br/><ol><br/>	<li>Login to the <strong>Appliance Configurator</strong> (https://your_workspace:8443), click<strong> Install Certificate</strong></li><br/>	<li>In the Terminate SSL on Workspace appliance tab, paste the complete certificate chain (what we created above) and also include the private key in its box.</li><br/>	<li>Save the SSL certificate.</li><br/></ol><br/><span style="text-decoration:underline;">To do this on vIDM:</span><br/><ol><br/>	<li>In the <strong>Administration Console</strong>, click <strong>Appliance Settings</strong></li><br/>	<li>Click <strong>Manage Configuration</strong> and enter the admin password</li><br/>	<li>Click Install Certificate</li><br/>	<li>In the <strong>Terminate SSL on Identity Manager Appliance</strong> tab, select <strong>C<span id="GUID-5D5C4B3C-21C7-44E4-86BD-6CE22C9746BE__uicontrol_0A913D0AAF82426CA447D8C876D1163D" class="uicontrol">ustom <span class="resultofText"><span class="resultofText">Certif</span>icate</span></span></strong>.</li><br/></ol><br/>If you're using a Load Balancer or Reverse Proxy, you'll need to instead install the cert on that device per the vendor's instructions. Using something like NGINX is quite simple as you simply include the cert and private key path in the configuration file (See<a href="http://thatvirtualboy.com/2014/11/20/how-to-setup-nginx-as-a-reverse-proxy-for-workspace-portal-2-1/" target="_blank"> How to Setup NGINX as a reverse proxy for Workspace Portal 2.1</a>)<br/><br/>If you're using an internal CA, or otherwise a lesser known CA, it may be necessary to install the Root CA on Workspace in order for it to gain trust. Back at the <strong>Install Certificate</strong> page, click the <strong>Terminate SSL on a Load Balancer</strong> tab, and paste the PEM output of the Root CA here.<br/><br/>NOTE: if you've previously installed custom certs on Workspace itself, and are now trying to instead use a Load Balancer, you will need to first re-generate the self signed certs on Workspace before you'll be able to properly reconfigure the Workspace FQDN.<br/><br/><span style="color:#ff0000;">[Important]</span><br/>If you happen to use a KEMP load balancer with Workspace, you may run into issues configuring your FQDN after following the recommended SSL Certificate process. Please review <a href="https://support.kemptechnologies.com/hc/en-us/articles/203858065-VMware-Horizon-Workspace" target="_blank">Kemp's Workspace Documentation</a> which should help get the load balancer configured properly.<br/><h3>Related documentation and references</h3><br/><div><a href="http://blogs.vmware.com/horizontech/2014/10/troubleshoot-workspace-portal-setup-issues-changing-fqdn.html" target="_blank">Troubleshooting changing the Workspace Portal FQDN<br/></a><a href="http://pubs.vmware.com/vidm-24/topic/com.vmware.wsp-install_24/GUID-5D5C4B3C-21C7-44E4-86BD-6CE22C9746BE.html" target="_blank">Apply Public Certificate Authority to vIDM</a></div><br/><div><a href="http://pubs.vmware.com/workspace-portal-21/topic/com.vmware.wsp-install_21/GUID-B76761BF-4B12-4CD5-9366-B0A1A2BF2A8B.html" target="_blank">Using SSL Certificates in Workspace</a></div><br/><div><a href="http://pubs.vmware.com/workspace-portal-21/topic/com.vmware.wsp-install_21/GUID-AF326FAF-FB48-4978-A0F6-ADF4CBDC0942.html" target="_blank">Apply Workspace Root Cert to the Load Balancer</a></div>
