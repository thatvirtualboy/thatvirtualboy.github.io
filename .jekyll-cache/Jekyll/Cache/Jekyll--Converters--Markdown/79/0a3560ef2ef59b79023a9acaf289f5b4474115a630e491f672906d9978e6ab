I"­<p>In <a href="https://thatvirtualboy.com/migrating-paid-app-to-subscription-freemium-1/">Part 1</a> of this 2-part series, I discussed the differences between the different pricing strategies developers are faced with in todayâ€™s app market.</p>

<p>In this post, Iâ€™ll share some technical details on how I converted my paid app to subscription/freemium.</p>

<p>When making such a drastic change in the pricing model for your app, you need to consider how to handle existing users who have already purchased your app up-front. Some apps disregard previous buyers and force them into the subscription model moving forward. If you want to avoid your app reviews being consumed with 1-star reviews, Iâ€™d recommend against this method.</p>

<p>I chose to honor existing users by ensuring they receive the appâ€™s <em>Lifetime Subscription</em> at no additional cost. When they originally bought the app, they were agreeing to have that app and its full functionality from the get-go. Honoring this choice is not only fair, but puts the user first.</p>

<p>So how did I achieve this?</p>

<h3 id="revenuecat">RevenueCat</h3>
<p><img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Ffiles.readme.io%2F5c97626-OG_image.png&amp;f=1&amp;nofb=1" alt="" />
By far the easiest path to implementing subscriptions is to use <a href="https://www.revenuecat.com">RevenueCat</a>. At first I didnâ€™t like the idea of relying on a 3rd party for such a crucial function in my app, but the closer you look into RC and their SDK, the more you realize itâ€™s not only the path of least resistance, itâ€™s actually quite a joy to work with. Perhaps best of all, RevenueCat is free to use for any app making less than $10,000 MTR (Monthly Tracked Revenue).</p>

<p>RC has a terrific <a href="https://docs.revenuecat.com/docs/getting-started">Quickstart Guide</a> which Iâ€™m not going to re-hash in this post. The combination of RCâ€™s documentation, and <a href="https://www.youtube.com/watch?v=0H2SdKf4ot0">this video walkthrough</a> from <a href="https://designcode.io/instructor/sai">Sai</a> of <a href="https://designcode.io">Design+Code</a> helped me get up and running super quick.</p>

<blockquote>
  <p>I should mention the above video utilizes RevenueCat SDK 3 so be sure to utilize RCâ€™s <a href="https://github.com/RevenueCat/purchases-ios/blob/main/Documentation.docc/V4_API_Migration_guide.md">V4 SDK documentation</a> to make any necessary adjustments if you decide to use their latest builds.</p>
</blockquote>

<p>Once you have RevenueCat up and running in your app, you can begin handling your grandfathered users.</p>

<p>My app is a SwiftUI app with the SwiftUI App Lifecycle.</p>

<p>In my <strong>App.swift</strong> file, I built a check that validates the appâ€™s build number in the userâ€™s receipt from when they originally downloaded the app. This checks the value of <code class="highlighter-rouge">originalApplicationVersion</code> from the receipt.</p>

<script src="https://gist.github.com/thatvirtualboy/dce533c039c0b0d7f42f74e07e689cd1.js"></script>

<p>In the above sample, Iâ€™m using a <code class="highlighter-rouge">compare</code> operation on the Swift Numeric to validate if the Receipt Build Number is less than, greater than, or equal to the build number that reflects the new pricing model. You can read more about numerics and compare on <a href="https://sarunw.com/posts/how-to-compare-two-app-version-strings-in-swift/">Sarunâ€™s site here</a>.</p>

<p>Then based on whether or not the user is calculated as <em>grandfathered</em>, I save that as a <strong>boolean</strong> value in the <code class="highlighter-rouge">UserDefault</code> value <code class="highlighter-rouge">grandfatheredPro</code></p>

<blockquote>
  <p>NOTE: I initialize <code class="highlighter-rouge">freemiumBuild</code> as <code class="highlighter-rouge">1.0</code> because your app will always reflect a build number of <code class="highlighter-rouge">1.0</code> while in development. You will want to change this value to your actual <strong>build</strong> number when pushing to production.</p>
</blockquote>

<p>Now, at app launch we want to validate if the user is a <strong>Pro</strong> user or not, then handle the paywalls within the app accordingly. In my app, I use the <code class="highlighter-rouge">UserDefault</code> flag <code class="highlighter-rouge">isPro</code> for this. In our case, we want the flag <code class="highlighter-rouge">isPro</code> to equal true if they have an active entitlement, <strong>or</strong> if they are a grandfathered user:</p>

<script src="https://gist.github.com/thatvirtualboy/1eac178d6c4a28cf4d8baf4224932983.js"></script>

<p>Great! We can now know if the user should be a Pro user or not. However this code alone will not work right off the bat for your existing paid users.</p>

<p>The issue here is that user receipts arenâ€™t synced to RevenueCat until <em>after</em> a user either makes a purchase, or calls <code class="highlighter-rouge">restoreTransations</code> (usually handled with a <strong>Restore Purchases</strong> button). So upon initial upgrade, the above code will print out <code class="highlighter-rouge">*** NO RECEIPT FOUND ***</code> for all users.</p>

<p>This unfortunately means that every paid user who upgrades the app to the new Subscription model version will initially start out as a Free user.</p>

<p>We need a way to make it easy for our users to pull that receipt data. I would imagine there are lots of ways to accomplish this. I would have thought to just code the restore operation, however RevenueCatâ€™s documentation <a href="https://docs.revenuecat.com/docs/restoring-purchases">states that we shouldnâ€™t do that programatically</a>.</p>

<p>In my case, I ended up adding a note in my <strong>Whatâ€™s New</strong> popup for users to <em>Finish their upgrade</em> by tapping a button. That button would then call the <code class="highlighter-rouge">restorePurchases</code> method, then display an Alert. The alert explains that the user should now restart the app to reflect the changes.</p>

<p>Itâ€™s not a perfect system. I wish it could have been done all behind the scenes without any user interaction, but this method seemed to work, and users were happy to continue their Lifetime license.</p>
:ET