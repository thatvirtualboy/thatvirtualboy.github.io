I"å<p>Iâ€™ve successfully configured Time Machine backups over my home network using VMware Workstation, Ubuntu, and a 1 TB WD drive. A big thanks to HowToGeek for their Raspberry Pi <a href="http://www.howtogeek.com/276468/how-to-use-a-raspberry-pi-as-a-networked-time-machine-drive-for-your-mac/" target="_blank">post</a>Â for the inspiration and to Netatalkâ€™s <a href="http://netatalk.sourceforge.net/wiki/index.php/Install_Netatalk_3.1.10_on_Ubuntu_14.04_Trusty" target="_blank">Wiki</a>.Â Here we go!<br />&lt;h3&gt;<img alt="screen-shot-2016-11-03-at-8-44-29-am" class="alignnone size-full wp-image-2329" height="452" src="https://thatvirtualboy.files.wordpress.com/2016/11/screen-shot-2016-11-03-at-8-44-29-am.png" width="640" />:: Prerequisites&lt;/h3&gt;&lt;ul&gt;<br />&lt;li&gt;Windows (using Windows 10 in this tutorial)&lt;/li&gt;<br />&lt;li&gt;VMware Workstation (using 12.5 Pro)&lt;/li&gt;<br />&lt;li&gt;Linux ISO (using Ubuntu 16.04 mini.iso)&lt;/li&gt;<br />&lt;li&gt;Dedicated backup drive (using a 1TB WD) formatted as HFS+&lt;/li&gt;<br />&lt;li&gt;macOS Seirra&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;:: Prepare your drive&lt;/h3&gt;<br />Format your hard drive to be HFS+. This can be done by booting to any linux live disk and using <em>gparted</em>. Youâ€™ll likely need to install <strong>hfsprogs</strong> and <strong>hfsplus</strong> to enable the formatting.<br /><br />When attached to your Windows Host system, Windows wonâ€™t mount this drive inÂ Explorer, but you can still see it in Windows Disk Management to ensure itâ€™s working properly. Here it shows as <strong>Disk 0</strong><img alt="screen-shot-2016-11-02-at-9-22-21-pm" class="alignnone size-full wp-image-2298" height="250" src="https://thatvirtualboy.files.wordpress.com/2016/11/screen-shot-2016-11-02-at-9-22-21-pm.png" width="640" /><br /><br />Choose a mount point that your backup server will use for the drive. Iâ€™ll use <strong>/media/tm</strong><br />Choose a user that will connect to your backup server from the Mac. <strong>&lt;your-user&gt;</strong><br /><br />Save these for later.<br />&lt;h3&gt;:: Setting up the dedicated backup server&lt;/h3&gt;<br />I run my personal servers on a Windows 10 box under VMware Workstation. Itâ€™s plain simple, easy to administer and maintain, and works great for home needs. Because I like dedicating my servers to individual VMs, I wanted a small VM to attach my 1 TB backup drive to - something with a small footprint as I wonâ€™t need to interact with the OS much. This is why I chose to use Ubuntuâ€™s mini.iso<br />&lt;ol&gt;<br />&lt;li&gt;In Workstation, create a new VM using the <strong>mini.iso</strong>. The only â€˜optionsâ€™ I chose to install with it were <strong>opensshserver</strong>Â for management, and <strong>samba</strong> (might use this in the future). My VM uses 512 MB of RAM and 1vCPU.&lt;/li&gt;<br />&lt;li&gt;ObtainÂ HFS+ support by running<br />&lt;pre&gt;sudo apt-get install hfsprogs hfsplus&lt;/pre&gt;&lt;/li&gt;<br />&lt;li&gt;Letâ€™s take a moment to addÂ our disk to the VM. I chose for my VM to have direct access to the physical disk as its primary purpose will be for backups.<img alt="screen-shot-2016-11-02-at-9-25-48-pm" class="alignnone size-full wp-image-2303" height="372" src="https://thatvirtualboy.files.wordpress.com/2016/11/screen-shot-2016-11-02-at-9-25-48-pm.png" width="429" /><br /><img alt="screen-shot-2016-11-02-at-9-26-09-pm" class="alignnone size-full wp-image-2302" height="372" src="https://thatvirtualboy.files.wordpress.com/2016/11/screen-shot-2016-11-02-at-9-26-09-pm.png" width="427" />&lt;/li&gt;<br />&lt;li&gt;Now boot the VM back up, and mount the drive<br />&lt;pre&gt;sudo mount -t hfsplus -o force,rw /dev/sd* /media/tm&lt;/pre&gt;<br />You should also add this to <strong>/etc/fstab</strong> so it mounts properly at boot<br />&lt;pre&gt;/dev/sd* /media/tm hfsplus force,rw,user,auto 0 0&lt;/pre&gt;&lt;/li&gt;<br />&lt;li&gt;Setup permissions for your user that will connect to the server<br />&lt;pre&gt;sudo chown -R root:users <span style="color: #339966;">/media/tm</span><br />sudo chmod -R g+rwx <span style="color: #339966;">/media/tm</span><br />sudo usermod -a -G usersÂ <span style="color: #339966;">&lt;your-user&gt;</span>&lt;/pre&gt;&lt;/li&gt;<br />&lt;li&gt;Once thatâ€™s done, follow Netatalkâ€™s <a href="http://netatalk.sourceforge.net/wiki/index.php/Install_Netatalk_3.1.10_on_Ubuntu_14.04_Trusty" target="_blank">Wiki</a> on setting up v3.1.10 (current at time of writing) on Ubuntu 14.04 (my server is using Ubuntu 16.04 and I can attest it works). Here are the commands for reference:<br />&lt;pre&gt;sudo apt-get install build-essential libevent-dev libssl-dev libgcrypt11-dev libkrb5-dev libpam0g-dev libwrap0-dev libdb-dev libtdb-dev libmysqlclient-dev avahi-daemon libavahi-client-dev libacl1-dev libldap2-dev libcrack2-dev systemtap-sdt-dev libdbus-1-dev libdbus-glib-1-dev libglib2.0-dev libio-socket-inet6-perl tracker libtracker-sparql-1.0-dev libtracker-miner-1.0-dev&lt;/pre&gt;<br />&lt;pre&gt;wget http://prdownloads.sourceforge.net/netatalk/netatalk-3.1.10.tar.gz&lt;/pre&gt;<br />&lt;pre&gt;tar -xf netatalk-3.1.10.tar.gz&lt;/pre&gt;<br />&lt;pre&gt;cd netatalk-3.1.10&lt;/pre&gt;<br />&lt;pre&gt;./configure â€“with-init-style=debian-systemd â€“without-libevent â€“without-tdb â€“with-cracklib â€“enable-krbV-uam â€“with-pam-confdir=/etc/pam.d â€“with-dbus-sysconf-dir=/etc/dbus-1/system.d â€“with-tracker-pkgconfig-version=1.0&lt;/pre&gt;<br />&lt;pre&gt;make&lt;/pre&gt;<br />&lt;pre&gt;sudo make install&lt;/pre&gt;<br />Â &lt;/li&gt;&lt;li&gt;Now edit your <strong>/etc/nsswitch.conf</strong> and appendÂ <strong>mdns4 mdns</strong> to the end of the hosts file so it looks like this<br />&lt;pre&gt;hosts: files mdns4_minimal [NOTFOUND=return] dns mdns4 mdns&lt;/pre&gt;<br />Â &lt;/li&gt;&lt;li&gt;Create the fileÂ <strong>/etc/avahi/services/afpd.service</strong> with the below contents<br />&lt;pre&gt;&lt;?xml version=â€1.0â€ standalone=â€™noâ€™?&gt;&lt;!â€“<em>-nxml-</em>â€“&gt;<br />&lt;!DOCTYPE service-group SYSTEM â€œavahi-service.dtdâ€&gt;<br />&lt;service-group&gt;<br />   &lt;name replace-wildcards=â€yesâ€&gt;%h&lt;/name&gt;<br />   &lt;service&gt;<br />     &lt;type&gt;_afpovertcp._tcp&lt;/type&gt;<br />     &lt;port&gt;548&lt;/port&gt;<br />   &lt;/service&gt;<br />   &lt;service&gt;<br />     &lt;type&gt;_device-info._tcp&lt;/type&gt;<br />     &lt;port&gt;0&lt;/port&gt;<br />     &lt;txt-record&gt;model=TimeCapsule&lt;/txt-record&gt;<br />   &lt;/service&gt;<br />&lt;/service-group&gt;&lt;/pre&gt;Â &lt;/li&gt;<br />&lt;li&gt;SetupÂ the Netatalk AFP File Server config fileÂ <strong><strong><strong>/usr/local/etc/afp.conf</strong></strong></strong><br />&lt;pre&gt;[<span style="color: #339966;">&lt;your-user&gt;</span>]<br /> path = /home/<span style="color: #339966;">&lt;your-user&gt;</span><br /> rolist = <span style="color: #339966;">&lt;your-user&gt;</span><br /><br />[Global]<br /> mimic model = TimeCapsule6,106<br /><br />[Time Machine]<br /> path = /media/tm <span style="color: #339966;">(or whatever your mount point is)</span><br /> time machine = yes&lt;/pre&gt;&lt;/li&gt;<br />&lt;li&gt;Run the init scripts in this order<br />&lt;pre&gt;sudo /etc/init.d/avahi-daemon start&lt;/pre&gt;<br />&lt;pre&gt;sudo service netatalk start&lt;/pre&gt;&lt;/li&gt;&lt;li&gt;Add services to default runlevels<br />&lt;pre&gt;sudo update-rc.d avahi-daemon defaults<br />sudo update-rc.d netatalk defaults&lt;/pre&gt;&lt;/li&gt;<br />&lt;li&gt;Back on your Mac, add your Ubuntu machine to <strong>/etc/hosts</strong><br />&lt;pre&gt;x.x.x.x &lt;ubuntu-hostname&gt;&lt;/pre&gt;&lt;/li&gt;<br />&lt;li&gt;At this point, you should be able to connect to the server via hostname. From Finder Window, press <strong>command+KÂ </strong>and enter the server addressÂ <strong>afp://&lt;ubuntu-hostname&gt;</strong>Â &lt;/li&gt;<br />&lt;li&gt;Open Time Machine Preferences and select the Time Machine disk&lt;/li&gt;&lt;/ol&gt;If you donâ€™t see your disk in Time Machine preferences, ensure that it was mounted as <strong>read/write</strong> on the backup server. Good luck!</p>
:ET